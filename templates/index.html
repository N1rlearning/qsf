<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t.title }} - {{ t.subtitle }}</title>
    <meta name="description" content="{{ t.features }}">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- é…ç½® TailwindCSS -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#EEF2FF',
                            100: '#E0E7FF',
                            500: '#6366F1',
                            600: '#4F46E5',
                            700: '#4338CA',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .drag-over {
            border-color: #4F46E5 !important;
            background-color: #EEF2FF !important;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="bg-white shadow-sm sticky top-0 z-50 backdrop-blur-lg bg-white/95">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
            <a href="/" class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl flex items-center justify-center text-white text-xl">
                    ğŸ“„
                </div>
                <span class="text-xl font-bold text-gray-800">{{ t.title }}</span>
            </a>
            
            <nav class="flex items-center gap-4">
                <a href="/cn" class="text-sm px-3 py-1 rounded transition {% if lang == 'cn' %}bg-primary-100 text-primary-700 font-medium{% else %}text-gray-600 hover:text-primary-600{% endif %}">
                    ä¸­æ–‡
                </a>
                <a href="/en" class="text-sm px-3 py-1 rounded transition {% if lang == 'en' %}bg-primary-100 text-primary-700 font-medium{% else %}text-gray-600 hover:text-primary-600{% endif %}">
                    English
                </a>
            </nav>
        </div>
    </header>
    
    <!-- ä¸»è¦å†…å®¹ -->
    <main class="max-w-6xl mx-auto px-4 py-12">
        <!-- è‹±é›„åŒºåŸŸ -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-primary-600 to-purple-600 bg-clip-text text-transparent">
                {{ t.subtitle }}
            </h1>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                {{ t.features }}
            </p>
        </section>
        
        <!-- åŠŸèƒ½ç‰¹æ€§ -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
            <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
                <div class="w-14 h-14 bg-gradient-to-br from-primary-100 to-purple-100 rounded-xl flex items-center justify-center text-2xl mb-4">
                    ğŸ§¹
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ 'å»é™¤æ°´å°' if lang == 'cn' else 'Remove Watermark' }}</h3>
                <p class="text-gray-600 text-sm">{{ 'å¿«é€Ÿç§»é™¤PDFä¸­çš„æ°´å°æ–‡å­—' if lang == 'cn' else 'Quickly remove watermark text from PDFs' }}</p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
                <div class="w-14 h-14 bg-gradient-to-br from-primary-100 to-purple-100 rounded-xl flex items-center justify-center text-2xl mb-4">
                    ğŸ“±
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ 'ç§»é™¤äºŒç»´ç ' if lang == 'cn' else 'Remove QR Code' }}</h3>
                <p class="text-gray-600 text-sm">{{ 'è‡ªåŠ¨æ¸…é™¤å³ä¸‹è§’äºŒç»´ç æ°´å°' if lang == 'cn' else 'Automatically clear QR code watermark at bottom right' }}</p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
                <div class="w-14 h-14 bg-gradient-to-br from-primary-100 to-purple-100 rounded-xl flex items-center justify-center text-2xl mb-4">
                    ğŸ“‘
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ 'PDFåˆå¹¶' if lang == 'cn' else 'Merge PDF' }}</h3>
                <p class="text-gray-600 text-sm">{{ 'å°†å¤šä¸ªPDFæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ª' if lang == 'cn' else 'Combine multiple PDF files into one' }}</p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100">
                <div class="w-14 h-14 bg-gradient-to-br from-primary-100 to-purple-100 rounded-xl flex items-center justify-center text-2xl mb-4">
                    ğŸ”’
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ 'éšç§å®‰å…¨' if lang == 'cn' else 'Privacy' }}</h3>
                <p class="text-gray-600 text-sm">{{ 'æ‰€æœ‰å¤„ç†åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆ' if lang == 'cn' else 'All processing is done locally' }}</p>
            </div>
        </section>
        
        <!-- å¹¿å‘Šä½ -->
        <div class="bg-white rounded-xl p-4 mb-8 text-center border border-gray-200 min-h-[100px] flex items-center justify-center">
            <span class="text-gray-400 text-sm">{{ t.ad_placeholder }}</span>
        </div>
        
        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <section class="bg-white rounded-2xl shadow-xl p-8 mb-8 border-2 border-dashed border-gray-300 transition-all" id="dropZone">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">ğŸ“</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ t.upload_text }}</h2>
                <p class="text-gray-600">{{ t.upload_subtext }}</p>
            </div>
            
            <div class="text-center mb-6">
                <input type="file" id="fileInput" accept=".pdf" multiple class="hidden">
                <button onclick="document.getElementById('fileInput').click()" 
                        class="bg-gradient-to-r from-primary-600 to-primary-700 text-white px-8 py-3 rounded-xl font-semibold hover:from-primary-700 hover:to-primary-800 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                    ğŸ“‚ {{ 'é€‰æ‹©PDFæ–‡ä»¶' if lang == 'cn' else 'Select PDF Files' }}
                </button>
            </div>
            
            <!-- æ–‡ä»¶åˆ—è¡¨ -->
            <div class="file-list mt-6 space-y-3"></div>
        </section>
        
        <!-- å¤„ç†é€‰é¡¹ -->
        <section class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-6">{{ 'âš™ï¸ å¤„ç†é€‰é¡¹' if lang == 'cn' else 'âš™ï¸ Options' }}</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" id="removeText" checked 
                           class="w-5 h-5 text-primary-600 rounded focus:ring-primary-500">
                    <div>
                        <div class="font-medium text-gray-800">{{ t.option_text }}</div>
                        <div class="text-sm text-gray-500">{{ t.option_text_desc }}</div>
                    </div>
                </label>
                
                <label class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" id="removeQr" checked 
                           class="w-5 h-5 text-primary-600 rounded focus:ring-primary-500">
                    <div>
                        <div class="font-medium text-gray-800">{{ t.option_qr }}</div>
                        <div class="text-sm text-gray-500">{{ t.option_qr_desc }}</div>
                    </div>
                </label>
                
                <label class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" id="mergePdf" checked 
                           class="w-5 h-5 text-primary-600 rounded focus:ring-primary-500">
                    <div>
                        <div class="font-medium text-gray-800">{{ t.option_merge }}</div>
                        <div class="text-sm text-gray-500">{{ t.option_merge_desc }}</div>
                    </div>
                </label>
                
                <label class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" id="compress" checked 
                           class="w-5 h-5 text-primary-600 rounded focus:ring-primary-500">
                    <div>
                        <div class="font-medium text-gray-800">{{ t.option_compress }}</div>
                        <div class="text-sm text-gray-500">{{ t.option_compress_desc }}</div>
                    </div>
                </label>
            </div>
        </section>
        
        <!-- å¤„ç†æŒ‰é’® -->
        <div class="text-center mb-8">
            <button id="processBtn" onclick="processFiles()" disabled
                    class="bg-gradient-to-r from-primary-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:from-primary-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                ğŸš€ {{ t.btn_process }}
            </button>
        </div>
        
        <!-- è¿›åº¦æ¡ -->
        <div id="progressSection" class="hidden bg-white rounded-2xl shadow-xl p-8 mb-8 fade-in">
            <div class="text-center mb-4">
                <span id="progressText" class="text-gray-600">{{ t.btn_processing }}</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="bg-gradient-to-r from-primary-600 to-purple-600 h-4 rounded-full transition-all duration-300" 
                     style="width: 0%"></div>
            </div>
        </div>
        
        <!-- ç»“æœåŒºåŸŸ -->
        <div id="resultSection" class="hidden bg-white rounded-2xl shadow-xl p-8 fade-in">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-green-600 flex items-center gap-3">
                    {{ t.result_title }}
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">{{ t.result_success }}</span>
                </h2>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-primary-50 to-purple-50 rounded-xl p-4 text-center">
                    <div id="pageCount" class="text-3xl font-bold text-primary-600">0</div>
                    <div class="text-gray-600 text-sm mt-1">{{ t.pages }}</div>
                </div>
                <div class="bg-gradient-to-br from-primary-50 to-purple-50 rounded-xl p-4 text-center">
                    <div id="fileCount" class="text-3xl font-bold text-primary-600">0</div>
                    <div class="text-gray-600 text-sm mt-1">{{ t.files }}</div>
                </div>
                <div class="bg-gradient-to-br from-primary-50 to-purple-50 rounded-xl p-4 text-center">
                    <div id="watermarkCount" class="text-3xl font-bold text-primary-600">0</div>
                    <div class="text-gray-600 text-sm mt-1">{{ t.watermarks }}</div>
                </div>
                <div class="bg-gradient-to-br from-primary-50 to-purple-50 rounded-xl p-4 text-center">
                    <div id="outputSize" class="text-3xl font-bold text-primary-600">0 MB</div>
                    <div class="text-gray-600 text-sm mt-1">{{ t.size }}</div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <a id="downloadLink" href="#" 
                   class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-4 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg">
                    â¬‡ï¸ {{ t.btn_download }}
                </a>
                <button onclick="resetAll()"
                        class="flex-1 bg-gray-100 text-gray-700 py-4 rounded-xl font-semibold hover:bg-gray-200 transition-all">
                    ğŸ”„ {{ t.btn_reset }}
                </button>
            </div>
        </div>
        
        <!-- å¹¿å‘Šä½ -->
        <div class="bg-white rounded-xl p-4 mt-8 text-center border border-gray-200 min-h-[100px] flex items-center justify-center">
            <span class="text-gray-400 text-sm">{{ t.ad_placeholder }}</span>
        </div>
    </main>
    
    <!-- é¡µè„š -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-6xl mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="text-gray-600">
                    <strong class="text-gray-800">{{ t.title }}</strong> - {{ t.subtitle }}
                </div>
                <div class="flex items-center gap-6">
                    <a href="#" class="text-gray-600 hover:text-primary-600 transition">{{ 'ä½¿ç”¨æ¡æ¬¾' if lang == 'cn' else 'Terms' }}</a>
                    <a href="#" class="text-gray-600 hover:text-primary-600 transition">{{ 'éšç§æ”¿ç­–' if lang == 'cn' else 'Privacy' }}</a>
                    <a href="https://github.com/yourusername/pdf-tools" target="_blank" class="text-gray-600 hover:text-primary-600 transition">
                        GitHub
                    </a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // å…¨å±€å˜é‡
        let uploadedFiles = [];
        let processedPdfBytes = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ‹½ä¸Šä¼ 
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                handleFiles(e.dataTransfer.files);
            });
        });
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            handleFiles(e.target.files);
        }
        
        // å¤„ç†æ–‡ä»¶
        async function handleFiles(files) {
            for (let file of files) {
                if (file.type !== 'application/pdf') {
                    alert(`âš ï¸ ${file.name} ä¸æ˜¯PDFæ–‡ä»¶`);
                    continue;
                }
                
                if (file.size > 100 * 1024 * 1024) {
                    alert(`âš ï¸ ${file.name} è¶…è¿‡100MBé™åˆ¶`);
                    continue;
                }
                
                uploadedFiles.push({
                    name: file.name,
                    size: file.size,
                    file: file
                });
            }
            
            updateFileList();
            updateProcessButton();
        }
        
        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
        function updateFileList() {
            const container = document.querySelector('.file-list');
            
            if (uploadedFiles.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = uploadedFiles.map((file, index) => `
                <div class="flex items-center justify-between bg-gray-50 rounded-xl p-4">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">ğŸ“„</span>
                        <div>
                            <div class="font-medium text-gray-800">${file.name}</div>
                            <div class="text-sm text-gray-500">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <button onclick="removeFile(${index})" 
                            class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition">
                        âœ•
                    </button>
                </div>
            `).join('');
        }
        
        // ç§»é™¤æ–‡ä»¶
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            updateProcessButton();
        }
        
        // æ›´æ–°å¤„ç†æŒ‰é’®
        function updateProcessButton() {
            const btn = document.getElementById('processBtn');
            btn.disabled = uploadedFiles.length === 0;
            
            const lang = '{{ lang }}';
            const btnText = lang === 'cn' ? 'è¯·å…ˆä¸Šä¼ æ–‡ä»¶' : 'Please upload files first';
            
            if (uploadedFiles.length === 0) {
                btn.innerHTML = 'ğŸš€ ' + btnText;
            } else {
                const filesText = lang === 'cn' ? 'ä¸ªæ–‡ä»¶' : 'files';
                btn.innerHTML = `ğŸš€ {{ t.btn_process }} (${uploadedFiles.length} ${filesText})`;
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        // å¤„ç†æ–‡ä»¶
        async function processFiles() {
            if (uploadedFiles.length === 0) return;
            
            const removeText = document.getElementById('removeText').checked;
            const removeQr = document.getElementById('removeQr').checked;
            const mergePdf = document.getElementById('mergePdf').checked;
            const compress = document.getElementById('compress').checked;
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            document.getElementById('progressSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('processBtn').disabled = true;
            
            try {
                const formData = new FormData();
                for (let file of uploadedFiles) {
                    formData.append('files', file.file);
                }
                formData.append('remove_text', removeText);
                formData.append('remove_qr', removeQr);
                formData.append('merge', mergePdf);
                formData.append('compress', compress);
                formData.append('lang', '{{ lang }}');
                
                updateProgress(20, '{{ t.btn_processing }}');
                
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                updateProgress(80, '{{ t.btn_processing }}');
                
                if (result.success) {
                    document.getElementById('pageCount').textContent = result.stats.pages;
                    document.getElementById('fileCount').textContent = result.stats.files;
                    document.getElementById('watermarkCount').textContent = result.stats.watermarks;
                    document.getElementById('outputSize').textContent = result.stats.size_mb + ' MB';
                    
                    document.getElementById('downloadLink').href = '/download/' + result.task_id;
                    document.getElementById('resultSection').classList.remove('hidden');
                    
                    updateProgress(100, '{{ t.btn_processing }}');
                    
                    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('å¤„ç†å¤±è´¥: ' + result.error);
                }
                
            } catch (error) {
                alert('å¤„ç†å¤±è´¥: ' + error.message);
            }
            
            document.getElementById('processBtn').disabled = false;
        }
        
        // é‡ç½®
        function resetAll() {
            uploadedFiles = [];
            processedPdfBytes = null;
            
            updateFileList();
            updateProcessButton();
            
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('fileInput').value = '';
            document.getElementById('progressSection').classList.add('hidden');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
